---
description: Initialize or enhance a CLAUDE.md file with Anthropic's best practices
argument-hint: "[--standalone]"
allowed-tools: [Read, Write, Bash, Glob, Grep]
---

# Initialize CLAUDE.md

Create a best-practices CLAUDE.md file with optimal structure and token efficiency.

<context>
**Skill activated**: `claude-md-best-practices`
**Working directory**: !`pwd`
**Arguments**: `$ARGUMENTS`
</context>

<task>
Initialize CLAUDE.md using one of two modes:

1. **Enhance mode** (default): Optimizes existing CLAUDE.md generated by `/init`
2. **Standalone mode** (`--standalone`): Generates optimized CLAUDE.md from scratch
</task>

## Mode Detection

<mode_selection>
Check for `--standalone` flag in `$ARGUMENTS`:

- **If `--standalone` present**: Use standalone mode (generate from scratch)
- **If NOT present**: Use enhance mode (optimize existing file from `/init`)
</mode_selection>

---

## Mode 1: Enhance Mode (Default)

**Prerequisites**: User must run `/init` first to generate base CLAUDE.md

<enhance_workflow>

### Step 1: Check Prerequisites

```bash
# Check if CLAUDE.md exists
if [ ! -f "CLAUDE.md" ]; then
  echo "ERROR: No CLAUDE.md found"
  exit 1
fi
```

If CLAUDE.md does NOT exist:
```
❌ CLAUDE.md not found.

Please run Claude Code's built-in /init command first to generate a base CLAUDE.md, then run this command to enhance it with Anthropic's best practices.

**Workflow**:
1. /init                          # Generate base CLAUDE.md (Anthropic's analysis)
2. /claude-md-toolkit:init        # Enhance with best practices (this command)

**Alternatively**, use standalone mode to generate from scratch:
/claude-md-toolkit:init --standalone
```

STOP and EXIT.

### Step 2: Analyze Existing CLAUDE.md

Read the existing CLAUDE.md and determine:
- Current token count
- Current structure (has XML tags?)
- Project context present?
- Critical rules defined?

### Step 3: Enhance with Best Practices

Apply the same optimization logic as `/optimize-claude-md` with `--level=moderate`:

1. Create backup: `CLAUDE.md.backup-[timestamp]`
2. Apply optimizations:
   - Add XML semantic structure (`<project_context>`, `<critical_rules>`, etc.)
   - Apply persuasion principles to critical rules (Authority, Commitment)
   - Add priority attributes (`blocking`, `critical`, `recommended`)
   - Consolidate repetitive content
   - Improve hierarchy with proper nesting
3. Preview changes with before/after examples
4. Ask for user confirmation
5. Apply changes if confirmed

### Step 4: Success Message

```
✓ CLAUDE.md enhanced successfully!

**Applied enhancements**:
- ✓ XML semantic structure added
- ✓ Critical rules marked with priority attributes
- ✓ Persuasion principles applied
- ✓ Token-optimized structure

**Metrics**:
- Original: [X] tokens
- Enhanced: [Y] tokens
- Effectiveness: +[Z]% (structure score improved)

**Backup**: CLAUDE.md.backup-[timestamp]

**Next Steps**:
1. Review changes in your editor
2. Test with Claude Code
3. Commit: `git add CLAUDE.md && git commit -m "feat: enhance CLAUDE.md with best practices"`
```

</enhance_workflow>

---

## Mode 2: Standalone Mode (`--standalone`)

**Use case**: Generate optimized CLAUDE.md from scratch without requiring `/init`

<standalone_workflow>

### Step 1: Analyze Project

Detect project characteristics to generate contextual CLAUDE.md:

```bash
# Detect project size
total_loc=$(find . -type f \( -name "*.py" -o -name "*.js" -o -name "*.ts" -o -name "*.tsx" -o -name "*.go" -o -name "*.rs" \) 2>/dev/null | xargs wc -l 2>/dev/null | tail -1 | awk '{print $1}')

# Detect framework/language
framework="generic"
[ -f "manage.py" ] && framework="django"
[ -f "pyproject.toml" ] && grep -q "fastapi" pyproject.toml 2>/dev/null && framework="fastapi"
[ -f "package.json" ] && grep -q "react" package.json 2>/dev/null && framework="react"
[ -f "package.json" ] && grep -q "next" package.json 2>/dev/null && framework="nextjs"
[ -f "go.mod" ] && framework="go"
[ -f "Cargo.toml" ] && framework="rust"

# Determine size category
if [ "$total_loc" -lt 10000 ]; then
  size="small"
  token_target="800-1200"
elif [ "$total_loc" -lt 50000 ]; then
  size="medium"
  token_target="1200-2000"
else
  size="large"
  token_target="2000-2500"
fi
```

### Step 2: Select Template

Based on detected framework and size, select appropriate template:

**Available templates**:
- `generic-small.md` - Generic project, <10K LOC
- `generic-medium.md` - Generic project, 10-50K LOC
- `django-small.md` - Django project, <10K LOC
- `fastapi-small.md` - FastAPI project, <10K LOC
- `react-small.md` - React project, <10K LOC
- `nextjs-small.md` - Next.js project, <10K LOC
- (Additional templates for medium/large sizes)

**Template structure** (all templates follow this):
```xml
<project_context>
[Framework-specific context, e.g., "This is a Django web application..."]
</project_context>

<architecture>
[Framework-specific architecture patterns]
</architecture>

<critical_rules>
<rule id="..." priority="blocking">
[Framework-specific critical rules]
</rule>
</critical_rules>

<standards>
[Code standards, naming conventions, etc.]
</standards>

<common_commands>
[Common development commands]
</common_commands>
```

### Step 3: Generate CLAUDE.md

1. Check if CLAUDE.md already exists
   - If exists: Ask user if they want to overwrite (create backup first)
   - If not exists: Proceed with generation

2. Generate from template with project-specific values:
   - Replace `{PROJECT_NAME}` with detected/inferred name
   - Replace `{FRAMEWORK}` with detected framework
   - Replace `{SIZE}` with project size category
   - Include framework-specific rules and patterns

3. Ensure token count is within target range for project size

### Step 4: Templates

<template_generic_small>
```markdown
# CLAUDE.md

<project_context>
This is a {FRAMEWORK} project for [describe purpose]. The codebase follows [architectural pattern] principles.
</project_context>

<architecture>

## Project Structure

```
[Auto-detected directory structure]
```

</architecture>

<critical_rules>

<rule id="code-quality" priority="blocking">

## Code Quality Standards

YOU MUST ensure all code changes:
1. Pass existing tests (run test suite before committing)
2. Follow project coding standards
3. Include appropriate error handling

NEVER commit code that breaks existing functionality.

</rule>

</critical_rules>

<standards>

## Development Standards

- **Testing**: Write tests for new features
- **Documentation**: Update README.md for user-facing changes
- **Dependencies**: Document new dependencies and their purpose

</standards>

<common_commands>

## Development Commands

```bash
# [Framework-specific commands will be inserted here]
```

</common_commands>
```
</template_generic_small>

### Step 5: Success Message

```
✓ CLAUDE.md generated successfully!

**Generated for**:
- Framework: [detected framework]
- Size: [small/medium/large] (~[X] LOC)
- Token count: ~[Y] tokens (target: [Z])

**Features**:
- ✓ XML semantic structure
- ✓ Framework-specific rules and patterns
- ✓ Priority-based rule system
- ✓ Optimized for [framework] best practices

**Next Steps**:
1. Review and customize CLAUDE.md for your specific needs
2. Add project-specific rules in <critical_rules> section
3. Test with Claude Code
4. Run `/claude-md-toolkit:analyze-claude-md` to verify score
5. Commit: `git add CLAUDE.md && git commit -m "feat: add CLAUDE.md with best practices"`

**To enhance an existing /init-generated CLAUDE.md instead**:
Run `/claude-md-toolkit:init` (without --standalone flag)
```

</standalone_workflow>

---

## Error Handling

<error_cases>

**Enhance mode - CLAUDE.md not found**:
- Show clear message directing user to run `/init` first
- Suggest alternative: use `--standalone` mode
- EXIT without creating file

**Standalone mode - CLAUDE.md already exists**:
- Ask user: "CLAUDE.md already exists. Overwrite? (creates backup)"
- If yes: Create backup and proceed
- If no: EXIT

**Project analysis fails**:
- Fall back to generic template
- Inform user: "Could not detect framework, using generic template"
- Suggest manual customization

**Backup creation fails**:
- STOP immediately
- Show error message
- Do NOT modify or create files

</error_cases>

---

## Critical Rules

<rule priority="blocking">
In enhance mode, NEVER generate a file if CLAUDE.md doesn't exist. User MUST run /init first.
</rule>

<rule priority="blocking">
Always create backup before modifying existing CLAUDE.md. No exceptions.
</rule>

<rule priority="blocking">
Generated CLAUDE.md must be within token target range for project size.
</rule>

<rule priority="recommended">
Detect framework accurately - use multiple signals (files, dependencies, structure).
</rule>

<rule priority="recommended">
Make it clear which mode is being used (enhance vs standalone) in all user messages.
</rule>
